const c=document.getElementById("sourceLang"),r=document.getElementById("targetLang"),d=document.getElementById("backendUrl"),n=document.getElementById("translateBtn"),m=document.getElementById("toggleBtn"),h=document.getElementById("clearBtn"),y=document.getElementById("statusText"),f=document.getElementById("progressFill"),g=document.getElementById("stats");async function v(){const t=await chrome.runtime.sendMessage({action:"getSettings"});if(t!=null&&t.success){const e=t.settings;c.value=e.sourceLang,r.value=e.targetLang,d.value=e.backendUrl}}async function i(){const t={sourceLang:c.value,targetLang:r.value,backendUrl:d.value};await chrome.runtime.sendMessage({action:"saveSettings",data:t})}function a(t,e=0){y.textContent=t,f.style.width=`${e}%`}async function E(){a("Checking backend...",0);const t=await chrome.runtime.sendMessage({action:"checkHealth"});if(t!=null&&t.success){const e=t.health;e.ok?(a(`Backend ready (${e.yolo_format})`,100),n.disabled=!1):(a("Backend unhealthy",0),n.disabled=!0)}else a(`Backend offline: ${(t==null?void 0:t.error)||"Unknown"}`,0),n.disabled=!0}async function o(){const[t]=await chrome.tabs.query({active:!0,currentWindow:!0});return t||null}async function w(){await i();const t=await o();if(!(t!=null&&t.id)){a("No active tab",0);return}n.disabled=!0,a("Starting translation...",10);try{await chrome.tabs.sendMessage(t.id,{action:"translatePage",sourceLang:c.value,targetLang:r.value}),a("Translation started",20)}catch(e){a(`Error: ${e.message}`,0),n.disabled=!1}}async function B(){const t=await o();if(t!=null&&t.id)try{const e=await chrome.tabs.sendMessage(t.id,{action:"toggleOverlay"});e!=null&&e.success&&a(e.showingTranslated?"Showing translated":"Showing original",100)}catch(e){a(`Error: ${e.message}`,0)}}async function b(){const t=await o();if(t!=null&&t.id)try{await chrome.tabs.sendMessage(t.id,{action:"clearOverlays"}),a("Cleared all translations",0)}catch(e){a(`Error: ${e.message}`,0)}}async function l(){const t=await o();if(t!=null&&t.id)try{const e=await chrome.tabs.sendMessage(t.id,{action:"getStats"});if(e!=null&&e.success){const{stats:s,isProcessing:u}=e;g.textContent=`Images: ${s.total} | Translated: ${s.showingTranslated} | Cache: ${s.cache.count}`,u||(n.disabled=!1)}}catch{g.textContent="No page data"}}chrome.runtime.onMessage.addListener(t=>{t.action==="updateProgress"&&(a(t.data.message,t.data.percent),t.data.percent>=100&&(n.disabled=!1,l()))});n.addEventListener("click",w);m.addEventListener("click",B);h.addEventListener("click",b);c.addEventListener("change",i);r.addEventListener("change",i);d.addEventListener("blur",i);v();E();l();setInterval(l,2e3);
